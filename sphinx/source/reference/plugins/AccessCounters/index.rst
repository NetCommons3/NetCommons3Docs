############################
アクセスカウンター
############################

.. contents:: 目次
	:local:

*****************************
機能とパート、ロールの関係
*****************************


*****************************
画面
*****************************

=============================
セッティングモードOFF
=============================


=============================
セッティングモードON
=============================

-----------------------------
通常画面
-----------------------------

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
編集権限あり
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
公開権限あり：公開申請中の場合
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^



-----------------------------
編集画面
-----------------------------

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
編集中
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
プレビュー中
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^


-----------------------------
ブロックセッティング
-----------------------------




*****************************
ERD
*****************************

* frames , blocks, rooms, languages, usersは共通テーブルのため省略

=============================
データ構成
=============================

---------------------------------------------
アクセスカウンター [ access_counters ]
---------------------------------------------

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
テーブル
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
※後々、パートの設定等を当テーブルに追加する。

+-----------------------+------------------------------------+------------------------------------------------+
| カラム                | タイプ                             | 内容                                           |
+=======================+====================================+================================================+
| id                    | int(11) NOT NULL AUTO_INCREMENT    | PRIMARY                                        |
+-----------------------+------------------------------------+------------------------------------------------+
| block_id              | int(11) NOT NULL                   | ブロックID blocks.id                           |
+-----------------------+------------------------------------+------------------------------------------------+
| created               | datetime NOT NULL                  | 作成日時                                       |
+-----------------------+------------------------------------+------------------------------------------------+
| create_user_id        | int(11) NOT NULL DEFAULT '0'       | 作成者 users.id                                |
+-----------------------+------------------------------------+------------------------------------------------+
| modified              | datetime NOT NULL                  | 更新日時                                       |
+-----------------------+------------------------------------+------------------------------------------------+
| modified_user_id      | int(11) NOT NULL DEFAULT '0'       | 更新者 users.id                                |
+-----------------------+------------------------------------+------------------------------------------------+

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
インデックス
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
+-----------------------------------------------+-----------------------+-----------------------+
| インデックス                                  | タイプ                | カラム                |
+===============================================+=======================+=======================+
| PRIMARY                                       | PRIMARY               | id                    |
+-----------------------------------------------+-----------------------+-----------------------+
| idx_block_id                                  | KEY                   | block_id              |
+-----------------------------------------------+-----------------------+-----------------------+


-------------------------------------------------------------
アクセスカウンター カウント [ access_counters_counts ]
-------------------------------------------------------------

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
テーブル
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
+-----------------------+------------------------------------+------------------------------------------------+
| カラム                | タイプ                             | 内容                                           |
+=======================+====================================+================================================+
| id                    | int(11) NOT NULL AUTO_INCREMENT    | PRIMARY                                        |
+-----------------------+------------------------------------+------------------------------------------------+
| access_counter_id     | int(11) NOT NULL                   | アクセスカウンターID access_counter.id         |
+-----------------------+------------------------------------+------------------------------------------------+
| block_id              | int(11) NOT NULL                   | ブロックID blocks.id                           |
+-----------------------+------------------------------------+------------------------------------------------+
| language_id           | int(11) NOT NULL DEFAULT '1'       | 言語ID languages.id                            |
+-----------------------+------------------------------------+------------------------------------------------+
| access_count          | int(11) NOT NULL DEFAULT '0'       | アクセス元のIPアドレス                         |
+-----------------------+------------------------------------+------------------------------------------------+
| created               | datetime NOT NULL                  | 作成日時                                       |
+-----------------------+------------------------------------+------------------------------------------------+
| create_user_id        | int(11) NOT NULL DEFAULT '0'       | 作成者 users.id                                |
+-----------------------+------------------------------------+------------------------------------------------+
| modified              | datetime NOT NULL                  | 更新日時                                       |
+-----------------------+------------------------------------+------------------------------------------------+
| modified_user_id      | int(11) NOT NULL DEFAULT '0'       | 更新者 users.id                                |
+-----------------------+------------------------------------+------------------------------------------------+

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
インデックス
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
+-----------------------------------------------+-----------------------+-----------------------+
| インデックス                                  | タイプ                | カラム                |
+===============================================+=======================+=======================+
| PRIMARY                                       | PRIMARY               | id                    |
+-----------------------------------------------+-----------------------+-----------------------+
| idx_access_counters                           | KEY                   | access_counter_id     |
+-----------------------------------------------+-----------------------+-----------------------+
| idx_block_languages                           | KEY                   | block_id,             |
|                                               |                       | language_id           |
+-----------------------------------------------+-----------------------+-----------------------+


-----------------------------------------------------------------
アクセスカウンターフォーマット [ access_counters_formats ]
-----------------------------------------------------------------

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
テーブル
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
+-----------------------------+------------------------------------+------------------------------------------------+
| カラム                      | タイプ                             | 内容                                           |
+=============================+====================================+================================================+
| id                          | int(11) NOT NULL AUTO_INCREMENT    | PRIMARY                                        |
+-----------------------------+------------------------------------+------------------------------------------------+
| access_counter_id           | int(11) NOT NULL                   | アクセスカウンターID access_counter.id         |
+-----------------------------+------------------------------------+------------------------------------------------+
| block_id                    | int(11) NOT NULL                   | ブロックID blocks.id                           |
+-----------------------------+------------------------------------+------------------------------------------------+
| language_id                 | int(11) NOT NULL DEFAULT '1'       | 言語ID languages.id                            |
+-----------------------------+------------------------------------+------------------------------------------------+
| status_id                   | int(3) NOT NULL DEFAULT '1'        | 状態(記事タイプ)                               |
|                             |                                    |  * 1: 公開(Publish)                            |
|                             |                                    |  * 2: 公開申請(PublishRequest)                 |
|                             |                                    |  * 3: 下書き(Draft)                            |
|                             |                                    |  * 4: 差し戻し/取り下げ(Reject)                |
+-----------------------------+------------------------------------+------------------------------------------------+
| is_original                 | int(1) NOT NULL DEFAULT '1'        | オリジナル    1: オリジナル   0: 翻訳          |
+-----------------------------+------------------------------------+------------------------------------------------+
| show_number_image           | varchar(255) NOT NULL              | 数字画像イメージ                               |
+-----------------------------+------------------------------------+------------------------------------------------+
| show_digit_number           | int(3) NOT NULL DEFAULT '1'        | 表示桁数                                       |
+-----------------------------+------------------------------------+------------------------------------------------+
| show_format                 | varchar(255) NOT NULL              | フォーマット                                   |
+-----------------------------+------------------------------------+------------------------------------------------+
| created                     | datetime NOT NULL                  | 作成日時                                       |
+-----------------------------+------------------------------------+------------------------------------------------+
| create_user_id              | int(11) NOT NULL DEFAULT '0'       | 作成者 users.id                                |
+-----------------------------+------------------------------------+------------------------------------------------+
| modified                    | datetime NOT NULL                  | 更新日時                                       |
+-----------------------------+------------------------------------+------------------------------------------------+
| modified_user_id            | int(11) NOT NULL DEFAULT '0'       | 更新者 users.id                                |
+-----------------------------+------------------------------------+------------------------------------------------+

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
インデックス
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
+-----------------------------------------------+-----------------------+-----------------------------+
| インデックス                                  | タイプ                | カラム                      |
+===============================================+=======================+=============================+
| PRIMARY                                       | PRIMARY               | id                          |
+-----------------------------------------------+-----------------------+-----------------------------+
| idx_access_counter_id                         | KEY                   | access_counter_count_id,    |
|                                               |                       | status_id                   |
+-----------------------------------------------+-----------------------+-----------------------------+
| idx_block_access_counter_id                   | KEY                   | block_id,                   |
|                                               |                       | language_id,                |
|                                               |                       | status_id                   |
+-----------------------------------------------+-----------------------+-----------------------------+


=============================
連携図
=============================

.. image:: AccessCountersERD.png
	:scale: 80%
	:width: 80%

*****************************
機能
*****************************
